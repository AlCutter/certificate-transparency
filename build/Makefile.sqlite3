all: install

install: Makefile manifest
	$(MAKE)
	$(MAKE) sqlite3.c
	# FIXME: test fails on FreeBSD at least
	#$(MAKE) test
	#$(MAKE) install DESTDIR=`pwd`/../install
	$(MAKE) install

Makefile: Makefile.in configure
	# Tcl doesn't install locally
	CFLAGS="-fPIC" LDFLAGS="-fPIC" ./configure --prefix=`pwd`/../install --disable-tcl

manifest:
	../sqlite3-export/create-fossil-manifest
