#!/bin/sh

# Helper for gclient

INSTALL=`pwd`/install
GMOCK=`pwd`/googlemock
PATH=$INSTALL/bin:$PATH

set -e

cd certificate-transparency
if [ ! -f configure ]
then
	./autogen.sh
fi
if [ ! -f Makefile ]
then
  case `uname` in
    Darwin)
      # TODO(alcutter): Figure out how to use tcmalloc on OSX.
      # The problem is that there are multiple ways of having it installed;
      # macports should Just Work (maybe?), but brew squirrels it away
      # somewhere and you'd need a brew --prefix perftools to find out where
      # the dynlibs are.
      CONFIGURE_FLAGS="--without-tcmalloc"
      EXTRA_LDFLAGS="-lresolv"
      ;;
    FreeBSD)
      EXTRA_LDFLAGS="-L/usr/local/lib"
      ;;
  esac
    # FIXME: MacOS needs -lresolv
    #CPPFLAGS="-I$INSTALL/include" LDFLAGS="-L$INSTALL/lib" LIBS="-lresolv" ./configure GMOCK_DIR=$GMOCK
    PKG_CONFIG_PATH="$INSTALL/lib/pkgconfig" CPPFLAGS="-I$INSTALL/include" LDFLAGS="-L$INSTALL/lib $EXTRA_LDFLAGS" LIBS="-lpthread" ./configure GMOCK_DIR=$GMOCK $CONFIGURE_FLAGS
fi
